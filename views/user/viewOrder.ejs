<%- include("../layouts/header") %>
<%- include("../layouts/nav") %>

<div class="container mt-5">
    <% if (order && order.length > 0) { %>
        <% order.forEach(order => { %>
            <div class="card shadow-sm border-0 mb-4 rounded-lg">
                <div class="card-header py-3" style="background: linear-gradient(to right, #FFBA00, #FF6C00); color: white;">
                    <div class="row align-items-center">
                        <div class="col-12 col-sm-6 col-md-3 mb-2 mb-md-0">
                            <small class="text-light">Order Placed</small>
                            <div class="font-weight-bold"><%= new Date(order.date).toDateString() %></div>
                        </div>
                        <div class="col-12 col-sm-6 col-md-3 mb-2 mb-md-0">
                            <small class="text-light">Total</small>
                            <div class="font-weight-bold">&#8377;<%= order.totalPrice.toFixed(2) %></div>
                        </div>
                        <div class="col-12 col-sm-6 col-md-3 mb-2 mb-md-0">
                            <small class="text-light">Ship To</small>
                            <div class="font-weight-bold"><%= order.address.name %></div>
                        </div>
                        <div class="col-12 col-sm-6 col-md-3 text-md-right">
                            <small class="text-light">Order #</small>
                            <div class="font-weight-bold"><%= order.orderId %></div>
                            <div>
                                <a href="/order-details?orderId=<%= order._id %>" class="btn btn-sm btn-outline-light mt-2">View order details</a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <% order.items.forEach(item => { %>
                        <div class="row align-items-center mb-4">
                            <div class="col-md-2">
                                <img src="/productimages/<%= item.image %>" alt="Product Image" class="img-fluid rounded shadow-sm">
                            </div>
                            <div class="col-md-8">
                                <h5 class="mb-1 viewOrdersPdtName font-weight-bold"><%= item.productName %></h5>
                                <p class="mb-1 text-muted">Category: <%= item.categoryName %></p>
                                <p class="mb-1 text-muted">Quantity: <%= item.quantity %></p>
                                <% if (item.finalPrice) { %>
                                    <p class="mb-1 text-dark font-weight-bold">Price: &#8377;<%= item.finalPrice.toFixed(2) %></p>
                                <% } else { %>
                                    <p class="mb-1 text-dark font-weight-bold">Price: &#8377;<%= item.price.toFixed(2) %></p>
                                <% } %>
                            </div>
                            <div class="col-md-2 text-md-right">
                                <p class="status-text <%= item.itemStatus === 'Cancelled' ? 'status-cancelled' : 
                                    item.itemStatus === 'Delivered' ? 'status-delivered' : 
                                    item.itemStatus === 'Returned' || item.itemStatus === 'Return Pending' ? 'status-returned' : '' %>">
                                    Status: <%= item.itemStatus %>
                                </p>
                            </div>
                        </div>
                    <% }); %>
                </div>
            </div>
        <% }); %>
    <% } else { %>
        <div class="row justify-content-center mt-5">
            <div class="col-12 col-md-8 text-center">
                <h5 class="text-secondary">No orders found!</h5>
                <p class="mt-3" style="font-size: 13px;">Explore the shop and find something you like</p>
                <a href="/shop" class="btn btn-lg btn-primary mt-2" style="background: linear-gradient(to right, #FFBA00, #FF6C00); border: none;">Shop Now</a>
            </div>
        </div>
    <% } %>
</div>

<div class="pagination-container mt-5">
    <ul class="pagination justify-content-center">
        <% if (currentPage > 1) { %>
            <li class="page-item">
                <a class="page-link" href="?page=<%= currentPage - 1 %>">
                    <i class="zmdi zmdi-chevron-left"></i>
                </a>
            </li>
        <% } %>

        <% for(let i = 1; i <= totalPages; i++) { %>
            <li class="page-item <%= i === currentPage ? 'active' : '' %>">
                <a class="page-link <%= i === currentPage ? 'text-light' : 'text-dark' %>" href="?page=<%= i %>">
                    <%= i %>
                </a>
            </li>
        <% } %>

        <% if (currentPage < totalPages) { %>
            <li class="page-item">
                <a class="page-link" href="?page=<%= currentPage + 1 %>">
                    <i class="zmdi zmdi-chevron-right"></i>
                </a>
            </li>
        <% } %>
    </ul>
</div>

<style>
    .pagination .page-item.active .page-link {
        background: linear-gradient(to right, #FFBA00, #FF6C00);
        border-color: transparent;
    }
</style>

<%- include("../layouts/footer.ejs") %>
